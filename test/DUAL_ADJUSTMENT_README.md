# 双复权股票评分系统使用指南

## 📊 系统概述

本系统实现了**同时保留两种复权价格**的功能：
- **分析时使用后复权数据**：保证量化分析的准确性和连续性
- **显示时使用前复权数据**：提供直观的用户体验

## 🎯 核心特性

### 1. 双复权数据加载
- 同时获取后复权和前复权价格数据
- 自动合并两种复权类型的数据
- 保持数据完整性和一致性

### 2. 智能分析流程
- 技术指标计算使用后复权价格
- 评分算法基于后复权数据
- 保证分析结果的准确性

### 3. 用户友好显示
- 股票价格显示使用前复权数据
- 复权倍数自动计算和显示
- 直观的价格对比和分析

## 🚀 快速开始

### 运行双复权评分系统
```bash
python run_dual_adjustment_scoring.py
```

### 验证系统功能
```bash
python validate_dual_adjustment_system.py
```

### 测试双复权数据加载
```bash
python test_dual_adjustment.py
```

## 📋 技术实现

### 数据结构
```python
# 双复权数据包含以下字段
{
    'order_book_id': '600570.XSHG',  # 股票代码
    'date': '2025-09-16',           # 交易日期
    'close': 1560.49,               # 后复权收盘价（用于分析）
    'close_pre': 34.56,             # 前复权收盘价（用于显示）
    'open': 1557.33,                # 后复权开盘价
    'open_pre': 34.48,              # 前复权开盘价
    'high': 1567.71,                # 后复权最高价
    'high_pre': 34.72,              # 前复权最高价
    'low': 1536.56,                 # 后复权最低价
    'low_pre': 34.03,               # 前复权最低价
    # ... 其他技术指标字段
}
```

### 复权逻辑说明

#### 后复权 (Post-Adjustment)
- **用途**：量化分析、策略回测、技术指标计算
- **特点**：考虑所有分红配股，价格连续，适合长期趋势分析
- **示例**：600570 后复权价格 = 1560.49 元

#### 前复权 (Pre-Adjustment)
- **用途**：用户界面显示、直观价格对比
- **特点**：反映历史实际价格，不考虑分红配股
- **示例**：600570 前复权价格 = 34.56 元

#### 复权倍数计算
```
复权倍数 = 后复权价格 ÷ 前复权价格
600570 复权倍数 = 1560.49 ÷ 34.56 = 45.15x
```

## 📈 使用示例

### 1. 查看评分结果
运行系统后，您将看到类似以下输出：
```
=== 评分最高的20个股票（使用前复权价格显示） ===
排名   股票代码         综合评分     趋势强度     资金动能     技术指标     风险控制     评分等级   前复权价格
----   ------------     --------     --------     --------     --------     --------     --------   ----------
1      600570.XSHG      14.05        7.00         24.00        10.00        15.00        高风险股    34.56
2      000858.XSHE      16.00        15.00        20.00        13.00        15.00        高风险股    125.80
```

### 2. 理解数据含义
- **综合评分**：基于后复权数据的量化评分
- **前复权价格**：用户直观看到的价格
- **分析准确性**：评分基于连续的后复权数据
- **显示友好性**：价格使用熟悉的前复权数据

## 🔧 高级配置

### 修改默认复权类型
如果需要修改默认的复权设置，可以编辑：
```python
# modules/rqdatac_data_loader.py
def get_dual_adjustment_ohlcv_data(self,
                                   symbols: List[str],
                                   start_date: str,
                                   end_date: str,
                                   frequency: str = "1d") -> pl.DataFrame:
    # 可以修改这里的复权类型
    post_data = self._fetch_ohlcv_from_rqdatac(symbols, start_date, end_date, frequency, "post")
    pre_data = self._fetch_ohlcv_from_rqdatac(symbols, start_date, end_date, frequency, "pre")
```

### 自定义评分算法
如果需要修改评分逻辑，可以编辑：
```python
# compute/score_calculator.py
# 在这里修改评分算法，使用后复权数据进行计算
```

## ⚠️ 注意事项

### 1. 数据一致性
- 分析和回测使用后复权数据
- 显示和用户界面使用前复权数据
- 两种数据来源保持同步

### 2. 性能考虑
- 双复权数据加载时间约为单复权的2倍
- 建议在数据量大的情况下使用批量处理
- 可以考虑缓存机制优化性能

### 3. 复权类型选择
- **量化分析**：优先使用后复权
- **用户展示**：优先使用前复权
- **历史对比**：根据具体需求选择

## 📚 相关文档

- `verify_rqdatac_adjustment.py` - RQDatac复权数据验证
- `test_dual_adjustment.py` - 双复权数据加载测试
- `validate_dual_adjustment_system.py` - 系统完整验证
- `run_dual_adjustment_scoring.py` - 双复权评分主程序

## 🆘 故障排除

### 常见问题

1. **数据加载失败**
   - 检查RQDatac连接状态
   - 确认股票代码格式正确
   - 验证日期范围有效性

2. **复权倍数异常**
   - 检查股票是否有特殊分红配股历史
   - 确认数据时间范围的连续性
   - 验证RQDatac数据质量

3. **性能问题**
   - 减少同时处理的股票数量
   - 优化数据查询的时间范围
   - 考虑使用数据缓存机制

## 📞 技术支持

如果您在使用过程中遇到问题，请：
1. 查看相关日志文件
2. 运行验证脚本检查系统状态
3. 确认RQDatac服务可用性

---

**最后更新时间**: 2025年9月16日
**系统版本**: v2.0.0
**核心特性**: 双复权数据支持</content>
<parameter name="filePath">c:\Users\qxia1\Desktop\交易\项目代码\stockmonitor\DUAL_ADJUSTMENT_README.md